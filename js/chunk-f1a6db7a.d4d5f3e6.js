(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f1a6db7a"],{"0535":function(t,e,n){t.exports=n.p+"img/plus.733cbb8f.svg"},"2db2":function(t,e,n){t.exports=n.p+"img/bbglogo.0d5e05e2.svg"},"32be":function(t,e,n){"use strict";n.r(e);var a,o=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("van-overlay",{on:{click:function(e){return t.$emit("close")}}},[a("div",{staticClass:"dao-govern",on:{click:function(t){t.stopPropagation()}}},[a("div",{staticClass:"close",on:{click:function(e){return t.$emit("close")}}}),a("div",{staticClass:"title"},[t._v(t._s(t.$t("govern.text6")))]),a("div",{staticClass:"sub-title"},[t._v(t._s(t.$t("govern.text7")))]),a("div",{staticClass:"form"},[a("div",{staticClass:"input"},[a("div",{staticClass:"lable"},[a("span",[t._v(t._s(t.$t("govern.text15")))]),a("span",[t._v(t._s(t.$t("govern.text8"))+" "+t._s(t.balance0.toFixed(4)))])]),a("div",{staticClass:"amount"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.amount0,expression:"amount0"}],attrs:{type:"number",placeholder:"0.0000"},domProps:{value:t.amount0},on:{input:[function(e){e.target.composing||(t.amount0=e.target.value)},t.input]}}),a("div",[a("img",{attrs:{src:n("d059")}}),a("span",[t._v("OSK")])])])]),a("img",{attrs:{src:n("0535")}}),a("div",{staticClass:"input"},[a("div",{staticClass:"lable"},[a("span",[t._v(t._s(t.$t("govern.text16")))]),a("span",[t._v(t._s(t.$t("govern.text8"))+" "+t._s(t.balance1.toFixed(4)))])]),a("div",{staticClass:"amount"},[a("input",{attrs:{type:"number",placeholder:"0.0000",readonly:""},domProps:{value:t.amount1.toFixed(4)}}),a("div",[a("img",{attrs:{src:n("2db2")}}),a("span",[t._v("BHB")])])])])]),a("span",[t._v(t._s(t.$t("govern.text9"))),a("span",[t._v(t._s(t.getPower.toFixed(4)))])]),a("van-button",{directives:[{name:"show",rawName:"v-show",value:"none"===t.tradeState,expression:"tradeState === 'none'"}],staticClass:"double-button",on:{click:t.castingForce}},[t._v(t._s(t.btnText))]),a("van-button",{directives:[{name:"show",rawName:"v-show",value:"none"!==t.tradeState,expression:"tradeState !== 'none'"}],staticClass:"double-button",attrs:{loading:"","loading-text":t.btnText}})],1)])},s=[],i=(n("b0c0"),n("b680"),n("e7e5"),n("d399")),r=(n("96cf"),n("1da1")),c=n("ade3"),u=(n("66b9"),n("b650")),d=(n("f1dc"),n("6e47")),l={components:(a={},Object(c["a"])(a,d["a"].name,d["a"]),Object(c["a"])(a,u["a"].name,u["a"]),a),data:function(){return{balance0:0,balance1:0,getPower:0,amount0:"",amount1:"",allowance0:"0".toBN(),allowance1:"0".toBN(),inputing:!1,tradeState:"none"}},computed:{btnText:function(){return"approving"===this.tradeState?this.$t("govern.text2"):"trading"===this.tradeState?this.$t("govern.text3"):this.allowance0.lt(this.amount0)?this.$t("govern.text1",{symbol:"OSK"}):this.allowance1.lt(this.amount1)?this.$t("govern.text1",{symbol:"BHB"}):this.$t("govern.text4")}},created:function(){this.$contracts&&this.init()},methods:{init:function(){var t=this,e=new this.$web3.BatchRequest;e.add(this.$contracts.OSKToken.methods.balanceOf(this.$address).call.request({from:this.$address})),e.add(this.$contracts.OSKToken.methods.allowance(this.$address,this.$contracts.Govern.options.address).call.request({from:this.$address})),e.add(this.$contracts.BHBToken.methods.balanceOf(this.$address).call.request({from:this.$address})),e.add(this.$contracts.BHBToken.methods.allowance(this.$address,this.$contracts.Govern.options.address).call.request({from:this.$address})),e.requestManager.sendBatch(e.requests,(function(e,n){e||(t.balance0=("string"===typeof n[0]?n[0]:n[0].result).fromWei(),t.allowance0=n[1].result.fromWei().toBN(),t.balance1=n[2].result.fromWei(),t.allowance1=n[3].result.fromWei().toBN())}))},approve:function(){var t=this,e=this.$contracts[this.allowance0.lt(this.amount0)?"OSKToken":"BHBToken"].methods,n=(this.allowance0.lt(this.amount0)?this.amount0:this.amount1).toBN().times(10).toFixed();e.approve(this.$contracts.Govern.options.address,n.toWei()).send({from:this.$address}).on("transactionHash",(function(e){t.tradeState="approving"})).on("receipt",function(){var n=Object(r["a"])(regeneratorRuntime.mark((function n(a){var o;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.allowance(t.$address,t.$contracts.Govern.options.address).call({from:t.$address});case 2:o=n.sent,t["allowance".concat(t.allowance0.lt(t.amount0)?"0":"1")]=o.fromWei().toBN(),i["a"].success(t.$t("govern.text10")),t.tradeState="none";case 6:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}()).on("error",(function(e){i["a"].fail(t.$t("govern.text11")),t.tradeState="none"}))},castingForce:function(){var t=this;if(this.amount0<=0)return i["a"].fail(this.$t("govern.text12"));if(this.amount0.toBN().gt(this.balance0))return i["a"].fail(this.$t("govern.text5",{symbol:"OSK"}));if(this.amount1.toBN().gt(this.balance1))return i["a"].fail(this.$t("govern.text5",{symbol:"BHB"}));if(this.allowance0.lt(this.amount0)||this.allowance1.lt(this.amount1))return this.approve();var e=this.$contracts.Govern.methods.castingForce(this.$contracts.OSKToken.options.address,this.amount0.toWei(),this.$address);e.call({from:this.$address},(function(n,a){n||e.send({from:t.$address}).on("transactionHash",(function(e){t.tradeState="trading"})).on("receipt",(function(e){t.init(),i["a"].success(t.$t("govern.text13")),t.amount0="",t.amount1="",t.getPower=0,t.tradeState="none"})).on("error",(function(e){i["a"].fail(t.$t("govern.text14")),t.tradeState="none"}))}))},input:function(){var t=this;if(0===this.amount0.length)return this.amount1="",this.getPower=0,void(this.inputing=!1);if(this.amount0<=0)return this.amount1=0,this.getPower=0,void(this.inputing=!1);if(!this.inputing){this.inputing=!0;var e=setTimeout((function(){return 0===t.amount0.length?(t.amount1="",t.getPower=0,t.inputing=!1,void clearTimeout(e)):t.amount0<=0?(t.amount1=0,t.getPower=0,t.inputing=!1,void clearTimeout(e)):void t.$contracts.Govern.methods.getForceByToken(t.$contracts.OSKToken.options.address,t.amount0.toWei()).call({from:t.$address},(function(n,a){return 0===t.amount0.length?(t.amount1="",t.getPower=0,t.inputing=!1,void clearTimeout(e)):t.amount0<=0?(t.amount1=0,t.getPower=0,t.inputing=!1,void clearTimeout(e)):void(n||(t.getPower=a[0].fromWei(),t.amount1=a[1].fromWei(),t.inputing=!1,clearTimeout(e)))}))}),1e3)}}}},m=l,h=m,v=(n("ead8"),n("2877")),p=Object(v["a"])(h,o,s,!1,null,"1c9b93e4",null);e["default"]=p.exports},5362:function(t,e,n){},d059:function(t,e,n){t.exports=n.p+"img/osk.478dcd85.png"},ead8:function(t,e,n){"use strict";n("5362")}}]);