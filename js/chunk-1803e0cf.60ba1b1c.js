(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1803e0cf"],{"0535":function(t,s,e){t.exports=e.p+"img/plus.733cbb8f.svg"},"29a8":function(t,s,e){"use strict";e("7018")},"2db2":function(t,s,e){t.exports=e.p+"img/bbglogo.0d5e05e2.svg"},"32be":function(t,s,e){"use strict";e.r(s);var a=function(){var t=this,s=t._self._c;t._self._setupProxy;return s("van-overlay",{on:{click:function(s){return t.$emit("close")}}},[s("div",{staticClass:"dao-govern",on:{click:function(t){t.stopPropagation()}}},[s("div",{staticClass:"close",on:{click:function(s){return t.$emit("close")}}}),s("div",{staticClass:"title"},[t._v(t._s(t.$t("govern.text6")))]),s("div",{staticClass:"sub-title"},[t._v(t._s(t.$t("govern.text7")))]),s("div",{staticClass:"form"},[s("div",{staticClass:"input"},[s("div",{staticClass:"lable"},[s("span",[t._v(t._s(t.$t("govern.text15")))]),s("span",[t._v(t._s(t.$t("govern.text8"))+" "+t._s(t.balance0.toFixed(4)))])]),s("div",{staticClass:"amount"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.amount0,expression:"amount0"}],attrs:{type:"number",placeholder:"0.0000"},domProps:{value:t.amount0},on:{input:[function(s){s.target.composing||(t.amount0=s.target.value)},t.input]}}),s("div",[s("img",{attrs:{src:e("d059")}}),s("span",[t._v("OSK")])])])]),s("img",{attrs:{src:e("0535")}}),s("div",{staticClass:"input"},[s("div",{staticClass:"lable"},[s("span",[t._v(t._s(t.$t("govern.text16")))]),s("span",[t._v(t._s(t.$t("govern.text8"))+" "+t._s(t.balance1.toFixed(4)))])]),s("div",{staticClass:"amount"},[s("input",{attrs:{type:"number",placeholder:"0.0000",readonly:""},domProps:{value:t.amount1.toFixed(4)}}),s("div",[s("img",{attrs:{src:e("2db2")}}),s("span",[t._v("BHB")])])])])]),s("span",[t._v(t._s(t.$t("govern.text9"))),s("span",[t._v(t._s(t.getPower.toFixed(4)))])]),s("van-button",{directives:[{name:"show",rawName:"v-show",value:"none"===t.tradeState,expression:"tradeState === 'none'"}],staticClass:"double-button",on:{click:t.castingForce}},[t._v(t._s(t.btnText))]),s("van-button",{directives:[{name:"show",rawName:"v-show",value:"none"!==t.tradeState,expression:"tradeState !== 'none'"}],staticClass:"double-button",attrs:{loading:"","loading-text":t.btnText}})],1)])},o=[],n=(e("e7e5"),e("d399")),i=(e("66b9"),e("b650")),r=(e("f1dc"),e("6e47")),c={components:{[r["a"].name]:r["a"],[i["a"].name]:i["a"]},data(){return{balance0:0,balance1:0,getPower:0,amount0:"",amount1:"",allowance0:"0".toBN(),allowance1:"0".toBN(),inputing:!1,tradeState:"none"}},computed:{btnText(){return"approving"===this.tradeState?this.$t("govern.text2"):"trading"===this.tradeState?this.$t("govern.text3"):this.allowance0.lt(this.amount0)?this.$t("govern.text1",{symbol:"OSK"}):this.allowance1.lt(this.amount1)?this.$t("govern.text1",{symbol:"BHB"}):this.$t("govern.text4")}},created(){this.$contracts&&this.init()},methods:{init(){const t=new this.$web3.BatchRequest;t.add(this.$contracts.OSKToken.methods.balanceOf(this.$address).call.request({from:this.$address})),t.add(this.$contracts.OSKToken.methods.allowance(this.$address,this.$contracts.Govern.options.address).call.request({from:this.$address})),t.add(this.$contracts.BHBToken.methods.balanceOf(this.$address).call.request({from:this.$address})),t.add(this.$contracts.BHBToken.methods.allowance(this.$address,this.$contracts.Govern.options.address).call.request({from:this.$address})),t.requestManager.sendBatch(t.requests,(t,s)=>{t||(this.balance0=("string"===typeof s[0]?s[0]:s[0].result).fromWei(),this.allowance0=s[1].result.fromWei().toBN(),this.balance1=s[2].result.fromWei(),this.allowance1=s[3].result.fromWei().toBN())})},approve(){const t=this.$contracts[this.allowance0.lt(this.amount0)?"OSKToken":"BHBToken"].methods,s=(this.allowance0.lt(this.amount0)?this.amount0:this.amount1).toBN().times(10).toFixed();t.approve(this.$contracts.Govern.options.address,s.toWei()).send({from:this.$address}).on("transactionHash",t=>{this.tradeState="approving"}).on("receipt",async s=>{const e=await t.allowance(this.$address,this.$contracts.Govern.options.address).call({from:this.$address});this["allowance"+(this.allowance0.lt(this.amount0)?"0":"1")]=e.fromWei().toBN(),n["a"].success(this.$t("govern.text10")),this.tradeState="none"}).on("error",t=>{n["a"].fail(this.$t("govern.text11")),this.tradeState="none"})},castingForce(){if(this.amount0<=0)return n["a"].fail(this.$t("govern.text12"));if(this.amount0.toBN().gt(this.balance0))return n["a"].fail(this.$t("govern.text5",{symbol:"OSK"}));if(this.amount1.toBN().gt(this.balance1))return n["a"].fail(this.$t("govern.text5",{symbol:"BHB"}));if(this.allowance0.lt(this.amount0)||this.allowance1.lt(this.amount1))return this.approve();const t=this.$contracts.Govern.methods.castingForce(this.$contracts.OSKToken.options.address,this.amount0.toWei(),this.$address);t.call({from:this.$address},(s,e)=>{s||t.send({from:this.$address}).on("transactionHash",t=>{this.tradeState="trading"}).on("receipt",t=>{this.init(),n["a"].success(this.$t("govern.text13")),this.amount0="",this.amount1="",this.getPower=0,this.tradeState="none"}).on("error",t=>{n["a"].fail(this.$t("govern.text14")),this.tradeState="none"})})},input(){if(0===this.amount0.length)return this.amount1="",this.getPower=0,void(this.inputing=!1);if(this.amount0<=0)return this.amount1=0,this.getPower=0,void(this.inputing=!1);if(this.inputing)return;this.inputing=!0;const t=setTimeout(()=>0===this.amount0.length?(this.amount1="",this.getPower=0,this.inputing=!1,void clearTimeout(t)):this.amount0<=0?(this.amount1=0,this.getPower=0,this.inputing=!1,void clearTimeout(t)):void this.$contracts.Govern.methods.getForceByToken(this.$contracts.OSKToken.options.address,this.amount0.toWei()).call({from:this.$address},(s,e)=>0===this.amount0.length?(this.amount1="",this.getPower=0,this.inputing=!1,void clearTimeout(t)):this.amount0<=0?(this.amount1=0,this.getPower=0,this.inputing=!1,void clearTimeout(t)):void(s||(this.getPower=e[0].fromWei(),this.amount1=e[1].fromWei(),this.inputing=!1,clearTimeout(t)))),1e3)}}},h=c,l=h,d=(e("29a8"),e("2877")),u=Object(d["a"])(l,a,o,!1,null,"1c9b93e4",null);s["default"]=u.exports},7018:function(t,s,e){},d059:function(t,s,e){t.exports=e.p+"img/osk.478dcd85.png"}}]);